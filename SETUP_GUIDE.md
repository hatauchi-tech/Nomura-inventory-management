# 在庫管理システム 導入手順書

## 目次

1. [前提条件](#1-前提条件)
2. [Googleスプレッドシートの準備](#2-googleスプレッドシートの準備)
3. [Google Apps Scriptの設定](#3-google-apps-scriptの設定)
4. [Webアプリのデプロイ](#4-webアプリのデプロイ)
5. [初期設定](#5-初期設定)
6. [動作確認](#6-動作確認)
7. [運用開始準備](#7-運用開始準備)

---

## 1. 前提条件

### 1.1 必要なもの

- Googleアカウント（Google Workspace推奨）
- Webブラウザ（Chrome推奨）
- インターネット接続

### 1.2 推奨環境

| 項目 | 推奨 |
|------|------|
| ブラウザ | Google Chrome 最新版 |
| 画面解像度 | 1280x720以上 |
| インターネット | 安定した接続 |

### 1.3 権限要件

- Googleスプレッドシートの作成権限
- Google Apps Scriptの実行権限
- Webアプリのデプロイ権限

---

## 2. Googleスプレッドシートの準備

### 2.1 スプレッドシートの作成

1. Google Driveにアクセス
2. 「新規」→「Googleスプレッドシート」→「空白のスプレッドシート」
3. ファイル名を設定（例: `在庫管理システム_データ`）

### 2.2 シートの作成

以下の8つのシートを作成してください:

#### M_ユーザー（ユーザーマスタ）

| 列名 | データ型 | 説明 | 例 |
|------|---------|------|-----|
| ユーザーID | 文字列 | U+3桁連番 | U001 |
| 部門 | 文字列 | 所属部門 | 管理部 |
| ユーザー名 | 文字列 | 氏名 | 山田太郎 |
| メールアドレス | 文字列 | Googleアカウント | yamada@example.com |
| 権限 | 文字列 | 管理者/現場担当 | 管理者 |
| 有効 | 真偽値 | TRUE/FALSE | TRUE |

**ヘッダー行（1行目）**:
```
ユーザーID | 部門 | ユーザー名 | メールアドレス | 権限 | 有効
```

#### M_製品（製品マスタ）

| 列名 | データ型 | 説明 | 例 |
|------|---------|------|-----|
| 製品ID | 数値 | 自動採番 | 1 |
| 製品名 | 文字列 | 製品の名前 | 漆喰 白 |
| カテゴリ1 | 文字列 | 大分類 | 壁材 |
| カテゴリ2 | 文字列 | 小分類 | 漆喰 |
| 有効 | 真偽値 | TRUE/FALSE | TRUE |
| 単価 | 数値 | 製品単価 | 5000 |

**ヘッダー行（1行目）**:
```
製品ID | 製品名 | カテゴリ1 | カテゴリ2 | 有効 | 単価
```

#### M_保管場所（保管場所マスタ）

| 列名 | データ型 | 説明 | 例 |
|------|---------|------|-----|
| 保管場所ID | 文字列 | P+3桁連番 | P001 |
| 場所名 | 文字列 | 場所の名前 | 倉庫A |

**ヘッダー行（1行目）**:
```
保管場所ID | 場所名
```

#### T_在庫（在庫テーブル）

| 列名 | データ型 | 説明 |
|------|---------|------|
| 在庫ID | 文字列 | S+タイムスタンプ+ランダム3桁 |
| 製品ID | 数値 | M_製品の製品ID |
| 保管場所ID | 文字列 | M_保管場所の保管場所ID |
| 現在在庫数 | 数値 | 現在の在庫数 |
| 最終更新日時 | 日時 | 最終更新日時 |

**ヘッダー行（1行目）**:
```
在庫ID | 製品ID | 保管場所ID | 現在在庫数 | 最終更新日時
```

#### T_入出庫履歴（入出庫履歴テーブル）

| 列名 | データ型 | 説明 |
|------|---------|------|
| 履歴ID | 文字列 | H+タイムスタンプ+ランダム3桁 |
| 製品ID | 数値 | M_製品の製品ID |
| 数量 | 数値 | 入出庫数量 |
| 入出庫タイプ | 文字列 | 入庫/出庫/棚卸調整 |
| 現場名 | 文字列 | 出庫先の現場名 |
| 客先 | 文字列 | 顧客名 |
| 発生日時 | 日時 | 入出庫発生日時 |
| 操作ユーザーID | 文字列 | 操作者のユーザーID |
| 保管場所ID | 文字列 | 保管場所ID |

**ヘッダー行（1行目）**:
```
履歴ID | 製品ID | 数量 | 入出庫タイプ | 現場名 | 客先 | 発生日時 | 操作ユーザーID | 保管場所ID
```

#### T_棚卸履歴（棚卸イベントテーブル）

| 列名 | データ型 | 説明 |
|------|---------|------|
| 棚卸ID | 文字列 | I+タイムスタンプ+ランダム3桁 |
| イベント名 | 文字列 | 棚卸イベントの名前 |
| 棚卸実施日 | 日付 | 実施日 |
| ステータス | 文字列 | 進行中/確定済 |
| 担当ユーザーID | 文字列 | 作成者のユーザーID |

**ヘッダー行（1行目）**:
```
棚卸ID | イベント名 | 棚卸実施日 | ステータス | 担当ユーザーID
```

#### T_棚卸明細（棚卸明細テーブル）

| 列名 | データ型 | 説明 |
|------|---------|------|
| 棚卸明細ID | 文字列 | ID+タイムスタンプ+ランダム3桁 |
| 棚卸ID | 文字列 | T_棚卸履歴の棚卸ID |
| 製品ID | 数値 | M_製品の製品ID |
| 保管場所ID | 文字列 | M_保管場所の保管場所ID |
| 理論在庫数 | 数値 | システム上の在庫数 |
| 確定実在庫数 | 数値 | 確定した実在庫数 |
| 差異 | 数値 | 確定実在庫数 - 理論在庫数 |
| 差異理由 | 文字列 | 差異の理由 |

**ヘッダー行（1行目）**:
```
棚卸明細ID | 棚卸ID | 製品ID | 保管場所ID | 理論在庫数 | 確定実在庫数 | 差異 | 差異理由
```

#### T_棚卸担当者別入力（棚卸カウント入力テーブル）

| 列名 | データ型 | 説明 |
|------|---------|------|
| 入力ID | 文字列 | IC+タイムスタンプ+ランダム3桁 |
| 棚卸ID | 文字列 | T_棚卸履歴の棚卸ID |
| 担当ユーザーID | 文字列 | 入力者のユーザーID |
| 製品ID | 数値 | M_製品の製品ID |
| 保管場所ID | 文字列 | M_保管場所の保管場所ID |
| カウント数 | 数値 | カウントした数量 |
| 入力日時 | 日時 | 入力日時 |

**ヘッダー行（1行目）**:
```
入力ID | 棚卸ID | 担当ユーザーID | 製品ID | 保管場所ID | カウント数 | 入力日時
```

---

## 3. Google Apps Scriptの設定

### 3.1 Apps Scriptエディタを開く

1. 作成したスプレッドシートを開く
2. メニューから「拡張機能」→「Apps Script」を選択
3. Apps Scriptエディタが開く

### 3.2 ファイルの作成

以下のファイルを作成:

#### Code.gs
1. デフォルトの「コード.gs」を「Code.gs」にリネーム
2. 提供された `Code.gs` の内容を貼り付け

#### ServerSide.gs
1. 「+」ボタン→「スクリプト」を選択
2. ファイル名を「ServerSide」に設定
3. 提供された `ServerSide.gs` の内容を貼り付け

#### HTMLファイル
以下の各HTMLファイルを作成:

1. 「+」ボタン→「HTML」を選択
2. ファイル名を設定（拡張子.htmlは自動付与）
3. 提供された内容を貼り付け

| ファイル名 | 説明 |
|-----------|------|
| Index | ログイン画面 |
| HomeAdmin | 管理者ホーム |
| HomeUser | 一般ユーザーホーム |
| StockMovement | 入出庫登録 |
| StockMovementHistory | 入出庫履歴 |
| InventoryCount | 棚卸カウント入力 |
| InventoryVerify | 棚卸照合・確定 |
| StockList | 在庫一覧 |
| MasterManagement | マスタ管理 |
| Common | 共通CSS/JS |

### 3.3 スクリプトプロパティの設定（オプション）

別のスプレッドシートをデータソースとして使用する場合:

1. Apps Scriptエディタで「プロジェクトの設定」（歯車アイコン）を開く
2. 「スクリプトプロパティ」セクションで「スクリプトプロパティを追加」
3. 以下を設定:
   - プロパティ: `SPREADSHEET_ID`
   - 値: スプレッドシートのID（URLの `/d/` と `/edit` の間の文字列）

---

## 4. Webアプリのデプロイ

### 4.1 初回デプロイ

1. Apps Scriptエディタで「デプロイ」→「新しいデプロイ」を選択
2. 「種類の選択」で歯車アイコン→「ウェブアプリ」を選択
3. 以下を設定:
   - **説明**: 任意（例: 在庫管理システム v1.0）
   - **次のユーザーとして実行**: 「アクセスしているユーザー」
   - **アクセスできるユーザー**: 「全員」または組織内のユーザー
4. 「デプロイ」をクリック
5. 初回は承認が必要:
   - 「アクセスを承認」をクリック
   - Googleアカウントを選択
   - 「詳細」→「〇〇（安全ではないページ）に移動」
   - 「許可」をクリック
6. 表示されたURLをコピーして保存

### 4.2 更新デプロイ

コードを変更した場合:

1. 「デプロイ」→「デプロイを管理」を選択
2. 右上の鉛筆アイコン（編集）をクリック
3. 「バージョン」を「新バージョン」に変更
4. 「デプロイ」をクリック

---

## 5. 初期設定

### 5.1 管理者ユーザーの登録

1. スプレッドシートの「M_ユーザー」シートを開く
2. 以下のデータを入力:

| ユーザーID | 部門 | ユーザー名 | メールアドレス | 権限 | 有効 |
|-----------|------|-----------|--------------|------|------|
| U001 | 管理部 | （管理者名） | （Googleアカウント） | 管理者 | TRUE |

**重要**: メールアドレスは、ログインに使用するGoogleアカウントと完全一致させてください。

### 5.2 保管場所の登録

1. 「M_保管場所」シートを開く
2. 保管場所を登録:

| 保管場所ID | 場所名 |
|-----------|--------|
| P001 | 本社倉庫 |
| P002 | 支店倉庫 |

### 5.3 製品の登録

1. 「M_製品」シートを開く
2. 製品を登録:

| 製品ID | 製品名 | カテゴリ1 | カテゴリ2 | 有効 | 単価 |
|--------|--------|-----------|-----------|------|------|
| 1 | サンプル製品A | カテゴリ1 | サブカテゴリ1 | TRUE | 1000 |

**注意**: 製品IDは数値で連番にしてください。

---

## 6. 動作確認

### 6.1 ログイン確認

1. デプロイしたWebアプリのURLにアクセス
2. Googleアカウントでログイン
3. ホーム画面が表示されることを確認

### 6.2 基本機能の確認

以下の順序で動作確認:

1. **入庫登録**: 製品を入庫して在庫が増えることを確認
2. **出庫登録**: 製品を出庫して在庫が減ることを確認
3. **履歴確認**: 入出庫履歴が表示されることを確認
4. **在庫確認**: 在庫一覧で数量が正しいことを確認

### 6.3 トラブルシューティング

| 問題 | 確認事項 |
|------|----------|
| ログインできない | M_ユーザーにメールアドレスが登録されているか確認 |
| 画面が表示されない | ブラウザのコンソール(F12)でエラーを確認 |
| 在庫が更新されない | スプレッドシートの権限を確認 |

---

## 7. 運用開始準備

### 7.1 ユーザー登録

1. システムを使用する全ユーザーを「M_ユーザー」シートに登録
2. 権限を適切に設定:
   - **管理者**: 全機能を使用する責任者
   - **現場担当**: 出庫登録と棚卸入力を行う担当者

### 7.2 マスタデータ投入

1. 「M_製品」に全製品を登録
2. 「M_保管場所」に全保管場所を登録
3. 必要に応じて「T_在庫」に初期在庫を投入

### 7.3 ユーザーへの周知

1. WebアプリのURLを関係者に共有
2. 運用手順書（OPERATION_MANUAL.md）を配布
3. 操作説明会の実施（推奨）

### 7.4 バックアップ設定

1. スプレッドシートのコピーを定期的に作成
2. Google Driveの共有設定を確認

---

## チェックリスト

### 導入完了チェック

- [ ] Googleスプレッドシート作成済み
- [ ] 8つのシート作成済み（ヘッダー行含む）
- [ ] Apps Scriptファイル作成済み
- [ ] Webアプリデプロイ済み
- [ ] 管理者ユーザー登録済み
- [ ] ログイン動作確認済み
- [ ] 入出庫動作確認済み

### 運用開始チェック

- [ ] 全ユーザー登録済み
- [ ] 製品マスタ登録済み
- [ ] 保管場所マスタ登録済み
- [ ] 初期在庫投入済み（該当する場合）
- [ ] ユーザーへURL共有済み
- [ ] 運用手順書配布済み

---

## 改訂履歴

| バージョン | 日付 | 内容 |
|-----------|------|------|
| 1.0.0 | 2025年11月 | 初版作成 |

---

**作成日**: 2025年11月
**作成者**: システム管理者
